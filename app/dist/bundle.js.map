{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/classes/CanvasLogger.js","src/classes/Composition.js","src/classes/Gamefield.js","src/classes/Gameloop.js","src/classes/Image.js","src/classes/Logger.js","src/classes/Piece.js","src/classes/RecalculatedObjectsGroup.js","src/test.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","export default class CanvasLogger {\n  constructor(options) {\n    const defaultOptions = {};\n    this.options = {\n      ...defaultOptions,\n      ...options,\n    };\n  }\n\n  log(message) {\n    const textMessage = message.toString();\n    const canvas = this.options.canvas;\n    const fabricjsTextObject = new fabric.Text(textMessage, { left: canvas.width - 100, top: 10 });\n    canvas.add(fabricjsTextObject);\n    canvas.renderAll();\n  }\n}\n","/**\n * Created by dima on 02/07/2017.\n */\nimport Piece from './Piece';\n\nexport default class Composition {\n  constructor() {\n    const pieces = [];\n\n    this.addPiece = (piece) => {\n      if (!(piece instanceof Piece)) {\n        throw Error('Composition can`t store anything except except instance of Piece');\n      }\n      pieces.push(piece);\n    };\n\n    this.getPieces = () => pieces;\n  }\n}\n","/**\n * Created by dima on 02/07/2017.\n */\nexport default class Gamefield {\n  constructor({ width = 1024, height = 1024, canvasId = 'c' } = {}) {\n    let canvas;\n\n    this.getWidth = () => width;\n    this.getHeight = () => height;\n    this.getCanvasId = () => canvasId;\n    this.setCanvas = (canvasField) => {\n      canvas = canvasField;\n    };\n    this.getCanvas = () => canvas;\n\n    this.createField();\n  }\n\n  createField() {\n    const canvasId = this.getCanvasId();\n    if (!document.querySelector(`#${canvasId}`)) {\n      console.log('canvas doesn`t exists');\n      // create canvas element if it doesn't exists;\n      const canvasElement = document.createElement('canvas');\n      canvasElement.id = canvasId;\n      canvasElement.width = this.getWidth();\n      canvasElement.height = this.getHeight();\n      document.body.appendChild(canvasElement);\n    }\n    const canvas = new fabric.Canvas(canvasId, {\n      renderOnAddRemove: false,\n      selection: false,\n      backgroundColor: '#0f0',\n      width: this.getWidth(),\n      height: this.getHeight(),\n    });\n    this.setCanvas(canvas);\n  }\n}\n","/**\n * Created by dima on 02/07/2017.\n */\nimport Image from './Image';\nimport Gamefield from './Gamefield';\nimport RecalculatedObjectsGroup from './RecalculatedObjectsGroup';\nimport CanvasLogger from './CanvasLogger';\nimport Logger from './Logger';\n\nexport default class Gameloop {\n  constructor(options) {\n    if (!options.imageSelector) {\n      throw Error('image selector is not defined');\n    }\n    let canvas;\n    this.getOptions = () => options;\n\n    this.getCanvas = () => canvas;\n    this.setCanvas = (internalCanvas) => {\n      canvas = internalCanvas;\n    };\n  }\n\n  start() {\n    window.addEventListener('load', () => {\n      const options = this.getOptions();\n      const gameField = new Gamefield({\n        width: 1420,\n        height: 2048,\n        canvasId: options.canvasId,\n      });\n      const canvas = gameField.getCanvas();\n      this.setCanvas(canvas);\n      this.drawPieces(options.scale);\n      canvas.on('object:selected', () => {\n        if (window.debugApp) {\n          const canvasLogger = new CanvasLogger({ canvas });\n          const logger = new Logger({ loggerInterface: canvasLogger });\n          const activeObject = canvas.getActiveObject();\n          logger.log(activeObject);\n        }\n      });\n      canvas.on('object:modified', () => {\n        const activeObject = canvas.getActiveObject();\n        if (activeObject instanceof fabric.Path) {\n          return;\n        }\n        activeObject.trigger('recalculate');\n        const activeObjectNeighbours = this.getNeighbours(activeObject);\n        let isMerged = false;\n        canvas.forEachObject((potential) => {\n          if (isMerged) {\n            return;\n          }\n          if (potential === activeObject || !activeObject) {\n            return;\n          }\n\n          if (Gameloop.isNeighbour(activeObjectNeighbours, potential)) {\n            if (this.isClosest(activeObject, potential)) {\n              isMerged = true;\n              this.drawGroup(activeObject, potential);\n              canvas.remove(activeObject);\n              canvas.remove(potential);\n            }\n          }\n        });\n      });\n    });\n  }\n\n  drawSvg(img) {\n    const canvas = this.getCanvas();\n    const path = new fabric.Path(\n      'M85.446,52.284c-3.901,0-5.223-2.17-5.773-3.058c-1.146-1.85-3.291-3.455-5.469-4.268c-1.049-0.251-2.159,0.377-2.165,2.342  v24.737h-0.001v0.001H46.287c-1.978,0.002-2.604,1.122-2.347,2.177c0.815,2.173,2.418,4.312,4.264,5.457  c0.889,0.551,3.058,1.872,3.058,5.772c0,5.277-5.934,9.555-13.253,9.555c-7.32,0-13.254-4.277-13.254-9.555  c0-3.901,2.17-5.222,3.059-5.772c1.848-1.147,3.453-3.291,4.268-5.469c0.249-1.049-0.379-2.159-2.342-2.165H5V47.314  c0-1.977,1.114-2.606,2.166-2.355c2.178,0.812,4.322,2.418,5.47,4.268c0.551,0.888,1.871,3.058,5.772,3.058  c5.278,0,9.556-5.934,9.556-13.254c0-7.319-4.277-13.253-9.556-13.253c-3.901,0-5.222,2.17-5.772,3.059  c-1.146,1.845-3.284,3.447-5.458,4.263C6.122,33.356,5,32.727,5,30.745V5h67.038v0.001L72.039,5v25.759  c0.006,1.97,1.124,2.597,2.177,2.34c2.173-0.815,4.312-2.418,5.457-4.263c0.551-0.889,1.872-3.059,5.773-3.059  c5.276,0,9.554,5.934,9.554,13.253C95,46.351,90.723,52.284,85.446,52.284z',\n      {\n        fill: new fabric.Pattern({\n          source: img,\n        }),\n      },\n    );\n    path.set({ top: 150, left: 150 });\n    canvas.add(path);\n    canvas.renderAll();\n  }\n\n  drawPieces(scale = 1) {\n    const options = this.getOptions();\n    const canvas = this.getCanvas();\n    const image = new Image(options.imageSelector);\n\n    image.splitImageToPieces({ colLength: options.cols, rowLength: options.rows });\n    const pieces = image.getImagePieces();\n\n    pieces.forEach((piece, piecePosition) => {\n      const last = piecePosition === (pieces.length - 1);\n      const drawCallback = Gameloop.drawCallback.bind(null, { canvas, last, piecePosition, scale });\n      // const drawSvg = this.drawSvg.bind(this);\n      fabric.Image.fromURL(piece.getContent(), drawCallback);\n      // fabric.util.loadImage(piece.getContent(), drawSvg);\n    });\n  }\n\n  static drawCallback(additionalParams, img) {\n    const { canvas, last, piecePosition, scale } = additionalParams;\n    const top = fabric.util.getRandomInt(0, 300);\n    const left = fabric.util.getRandomInt(0, 300);\n\n    img.set('hasControls', false);\n    img.set('hasBorders', false);\n    img.set('top', top);\n    img.set('left', left);\n    img.set('piecePosition', piecePosition);\n    img.scale(scale);\n\n    canvas.add(img);\n    if (last) {\n      canvas.renderAll();\n    }\n  }\n\n  getNeighbours(examObject) {\n    const neighbours = [];\n    if (examObject) {\n      let piecePositions = [];\n      if (typeof examObject.piecePosition !== 'undefined') {\n        piecePositions.push(examObject.piecePosition);\n      } else if (examObject.piecePositions instanceof Array) {\n        piecePositions = examObject.piecePositions;\n      } else {\n        throw Error('examObject doesn`t contain any info about piece position');\n      }\n      const options = this.getOptions();\n      piecePositions.forEach((piecePosition) => {\n        const actualRow = Math.floor(piecePosition / options.cols);\n        const actualCol = piecePosition % options.cols;\n        if (actualRow !== 0) {\n          neighbours.push((piecePosition - options.cols));\n        }\n        if (actualRow < (options.rows - 1)) {\n          neighbours.push((piecePosition + options.cols));\n        }\n\n        if (actualCol !== 0) {\n          neighbours.push((piecePosition - 1));\n        }\n        if (actualCol < (options.cols - 1)) {\n          neighbours.push((piecePosition + 1));\n        }\n      });\n    }\n    return neighbours;\n  }\n\n  isClosest(current, potential) {\n    const activeObjectItems = current instanceof fabric.Group ? current.getObjects() : [current];\n    const potentialItems = potential instanceof fabric.Group ? potential.getObjects() : [potential];\n\n    for (const activeItem of activeObjectItems) {\n      for (const potentialItem of potentialItems) {\n        if (this.isPiecesClose(activeItem, potentialItem)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  isPiecesClose(firstPiece, secondPiece) {\n    const options = this.getOptions();\n    const closestSensitivity = options.neighboursSensitivity;\n    let xDifference = Math.abs(firstPiece.aCoords.tr.x - secondPiece.aCoords.tl.x);\n    let yDifference = Math.abs(firstPiece.aCoords.tr.y - secondPiece.aCoords.tl.y);\n    if (xDifference < closestSensitivity && yDifference < closestSensitivity) {\n      return true;\n    }\n\n    xDifference = Math.abs(firstPiece.aCoords.tl.x - secondPiece.aCoords.tr.x);\n    yDifference = Math.abs(firstPiece.aCoords.tl.y - secondPiece.aCoords.tr.y);\n    if (xDifference < closestSensitivity && yDifference < closestSensitivity) {\n      return true;\n    }\n\n    xDifference = Math.abs(firstPiece.aCoords.bl.x - secondPiece.aCoords.tl.x);\n    yDifference = Math.abs(firstPiece.aCoords.bl.y - secondPiece.aCoords.tl.y);\n    if (xDifference < closestSensitivity && yDifference < closestSensitivity) {\n      return true;\n    }\n\n    xDifference = Math.abs(firstPiece.aCoords.tl.x - secondPiece.aCoords.bl.x);\n    yDifference = Math.abs(firstPiece.aCoords.tl.y - secondPiece.aCoords.bl.y);\n    return xDifference < closestSensitivity && yDifference < closestSensitivity;\n  }\n\n  static isNeighbour(activeObjectNeighbours, potential) {\n    if (potential instanceof fabric.Group) {\n      for (const potentialItem of potential.getObjects()) {\n        if (activeObjectNeighbours.indexOf(potentialItem.piecePosition) !== -1) {\n          return true;\n        }\n      }\n    } else if (typeof potential.piecePosition !== 'undefined') {\n      return activeObjectNeighbours.indexOf(potential.piecePosition) !== -1;\n    }\n    return false;\n  }\n\n  drawGroup(activeObject, potential) {\n    const canvas = this.getCanvas();\n    const groupItems = [];\n    const piecePositions = [];\n    const options = this.getOptions();\n    const baseElements = potential instanceof fabric.Group ? potential.getObjects() : [potential];\n    const activeObjects = activeObject instanceof fabric.Group ? activeObject.getObjects() : [activeObject];\n\n    // baseElement is the potential element itself or first element from group;\n    const baseElement = baseElements[0];\n    const { col, row } = Gameloop.extractCoordinates(baseElement, options.cols);\n    const zeroDisplacementX = col * baseElement.getWidth();\n    const zeroDisplacementY = row * baseElement.getHeight();\n    const xDisplacement = baseElement.left - zeroDisplacementX;\n    const yDisplacement = baseElement.top - zeroDisplacementY;\n\n    const itemDecompose = (activePiece) => {\n      this.recalculatePiecePositions({\n        obj: activePiece,\n        xDisplacement,\n        yDisplacement,\n      });\n      piecePositions.push(activePiece.piecePosition);\n      groupItems.push(activePiece);\n    };\n\n    activeObjects.forEach(itemDecompose);\n    baseElements.forEach(itemDecompose);\n\n    const itemsRecalculableGroup = new RecalculatedObjectsGroup(groupItems, {\n      hasControls: false,\n      hasBorders: false,\n    });\n    itemsRecalculableGroup.set('piecePositions', piecePositions);\n    canvas.add(itemsRecalculableGroup);\n    canvas.renderAll();\n\n    // recalculated group objects coordinates\n    // it prevents to disappearing group object after merge\n    itemsRecalculableGroup.trigger('selected');\n    itemsRecalculableGroup.trigger('recalculate');\n  }\n\n  recalculatePiecePositions({ obj, xDisplacement, yDisplacement }) {\n    const options = this.getOptions();\n    const { col, row } = Gameloop.extractCoordinates(obj, options.cols);\n    const zeroDisplacementTop = row * obj.getHeight();\n    const zeroDisplacementLeft = col * obj.getWidth();\n    const recalculatedTop = zeroDisplacementTop + yDisplacement;\n    const recalculatedLeft = zeroDisplacementLeft + xDisplacement;\n    obj.setTop(recalculatedTop);\n    obj.setLeft(recalculatedLeft);\n    obj.setCoords();\n  }\n\n  static extractCoordinates(obj, cols) {\n    const col = obj.piecePosition % cols;\n    const row = Math.floor(obj.piecePosition / cols);\n    return { col, row };\n  }\n}\n","/**\n * Created by dima on 09/06/2017.\n */\nimport Piece from './Piece';\nimport Composition from './Composition';\n\nexport default class Image {\n  constructor(selector) {\n    const imageSelector = `img${selector}`;\n    this.imageElement = document.querySelector(imageSelector);\n    if (!this.imageElement) {\n      throw Error(`There is no img element with provided selector ${imageSelector}`);\n    }\n\n    this.imageInstance = this.getFabricImageInstance();\n    this.imagePieces = new Composition();\n  }\n\n  getFabricImageInstance() {\n    return this.imageInstance || new fabric.Image(this.imageElement);\n  }\n\n  splitImageToPieces({ colLength = 6, rowLength = 6 } = {}) {\n    const colSize = this.imageInstance.getWidth() / colLength;\n    const rowSize = this.imageInstance.getHeight() / rowLength;\n    for (let row = 0; row < rowLength; row += 1) {\n      for (let col = 0; col < colLength; col += 1) {\n        const dataUrl = this.imageInstance.toDataURL({\n          left: colSize * col,\n          top: rowSize * row,\n          width: colSize,\n          height: rowSize,\n        });\n        const pieceOptions = {\n          content: dataUrl,\n          position: row * col,\n        };\n        const piece = new Piece(pieceOptions);\n        this.imagePieces.addPiece(piece);\n      }\n    }\n  }\n\n  getImagePieces() {\n    return this.imagePieces.getPieces();\n  }\n\n  getImageElement() {\n    return this.imageElement;\n  }\n}\n","export default class Logger {\n  constructor(options) {\n    const defaultOptions = {\n      loggerInterface: console,\n    };\n    this.options = {\n      ...defaultOptions,\n      ...options,\n    };\n  }\n\n  log(message) {\n    this.options.loggerInterface.log(message);\n  }\n}\n","/**\n * Created by dima on 02/07/2017.\n */\nexport default class Piece {\n  constructor({ content, position } = {}) {\n    if (typeof content === 'undefined' || typeof position === 'undefined') {\n      throw Error('piece required content and position');\n    }\n    this.getContent = () => content;\n    this.getPosition = () => position;\n    return this.getContent();\n  }\n\n  getRow(cols) {\n    return Math.floor(this.getPosition() / cols);\n  }\n\n  getCol(cols) {\n    return this.getPosition() % cols;\n  }\n}\n","/**\n * Created by dima on 07/07/2017.\n */\nexport default class RecalculatedObjectsGroup {\n  constructor(groupItems, options = {}) {\n    if (!Array.isArray(groupItems)) {\n      throw Error('Group Items must be an array');\n    }\n    const group = new fabric.Group(groupItems, options);\n    group.on('selected', this.onSelected);\n    group.on('recalculate', this.onModified);\n\n    group.recalculateACoords = this.recalculateACoords;\n    group.onModified = this.onModified;\n    return group;\n  }\n\n  onSelected() {\n    this.selectedTop = this.top;\n    this.selectedLeft = this.left;\n  }\n\n  onModified() {\n    const groupObjects = this.getObjects();\n    groupObjects.forEach((groupItem) => {\n      this.recalculateACoords(groupItem);\n    });\n  }\n\n  recalculateACoords(item) {\n    const coords = {};\n    const itemCoords = item.aCoords;\n    const x = this.left - this.selectedLeft;\n    const y = this.top - this.selectedTop;\n    const offset = { x, y };\n\n    coords.tr = new fabric.Point(itemCoords.tr.x + offset.x, itemCoords.tr.y + offset.y);\n    coords.tl = new fabric.Point(itemCoords.tl.x + offset.x, itemCoords.tl.y + offset.y);\n    coords.br = new fabric.Point(itemCoords.br.x + offset.x, itemCoords.br.y + offset.y);\n    coords.bl = new fabric.Point(itemCoords.bl.x + offset.x, itemCoords.bl.y + offset.y);\n    item.aCoords = coords;\n    item.top = coords.tl.y;\n    item.left = coords.tl.x;\n  }\n}\n","/**\n * Created by dima on 18/05/2017.\n */\nimport Gameloop from './classes/Gameloop';\n\nconst options = {\n  canvasId: 'c',\n  rows: 6,\n  cols: 6,\n  scale: 0.8,\n  imageSelector: '[jjp-image]',\n  neighboursSensitivity: 20,\n};\nconst gameLoop = new Gameloop(options);\n\ngameLoop.start();\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xhc3Nlcy9DYW52YXNMb2dnZXIuanMiLCJzcmMvY2xhc3Nlcy9Db21wb3NpdGlvbi5qcyIsInNyYy9jbGFzc2VzL0dhbWVmaWVsZC5qcyIsInNyYy9jbGFzc2VzL0dhbWVsb29wLmpzIiwic3JjL2NsYXNzZXMvSW1hZ2UuanMiLCJzcmMvY2xhc3Nlcy9Mb2dnZXIuanMiLCJzcmMvY2xhc3Nlcy9QaWVjZS5qcyIsInNyYy9jbGFzc2VzL1JlY2FsY3VsYXRlZE9iamVjdHNHcm91cC5qcyIsInNyYy90ZXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0lDQXFCLFk7QUFDbkIsd0JBQVksT0FBWixFQUFxQjtBQUFBOztBQUNuQixRQUFNLGlCQUFpQixFQUF2QjtBQUNBLFNBQUssT0FBTCxnQkFDSyxjQURMLEVBRUssT0FGTDtBQUlEOzs7O3dCQUVHLE8sRUFBUztBQUNYLFVBQU0sY0FBYyxRQUFRLFFBQVIsRUFBcEI7QUFDQSxVQUFNLFNBQVMsS0FBSyxPQUFMLENBQWEsTUFBNUI7QUFDQSxVQUFNLHFCQUFxQixJQUFJLE9BQU8sSUFBWCxDQUFnQixXQUFoQixFQUE2QixFQUFFLE1BQU0sT0FBTyxLQUFQLEdBQWUsR0FBdkIsRUFBNEIsS0FBSyxFQUFqQyxFQUE3QixDQUEzQjtBQUNBLGFBQU8sR0FBUCxDQUFXLGtCQUFYO0FBQ0EsYUFBTyxTQUFQO0FBQ0Q7Ozs7OztrQkFma0IsWTs7Ozs7Ozs7O0FDR3JCOzs7Ozs7MEpBSEE7Ozs7O0lBS3FCLFcsR0FDbkIsdUJBQWM7QUFBQTs7QUFDWixNQUFNLFNBQVMsRUFBZjs7QUFFQSxPQUFLLFFBQUwsR0FBZ0IsVUFBQyxLQUFELEVBQVc7QUFDekIsUUFBSSxFQUFFLGdDQUFGLENBQUosRUFBK0I7QUFDN0IsWUFBTSxNQUFNLGtFQUFOLENBQU47QUFDRDtBQUNELFdBQU8sSUFBUCxDQUFZLEtBQVo7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QUFaO0FBQ0EsV0FBSyxPQUFMLEdBQWUsTUFBZjtBQUNBLFdBQUssR0FBTCxHQUFXLE9BQU8sRUFBUCxDQUFVLENBQXJCO0FBQ0EsV0FBSyxJQUFMLEdBQVksT0FBTyxFQUFQLENBQVUsQ0FBdEI7QUFDRDs7Ozs7O2tCQXhDa0Isd0I7Ozs7O0FDQXJCOzs7Ozs7QUFFQSxJQUFNLFVBQVU7QUFDZCxZQUFVLEdBREk7QUFFZCxRQUFNLENBRlE7QUFHZCxRQUFNLENBSFE7QUFJZCxTQUFPLEdBSk87QUFLZCxpQkFBZSxhQUxEO0FBTWQseUJBQXVCO0FBTlQsQ0FBaEIsQyxDQUxBOzs7O0FBYUEsSUFBTSxXQUFXLHVCQUFhLE9BQWIsQ0FBakI7O0FBRUEsU0FBUyxLQUFUIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhbnZhc0xvZ2dlciB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIC4uLmRlZmF1bHRPcHRpb25zLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgbG9nKG1lc3NhZ2UpIHtcbiAgICBjb25zdCB0ZXh0TWVzc2FnZSA9IG1lc3NhZ2UudG9TdHJpbmcoKTtcbiAgICBjb25zdCBjYW52YXMgPSB0aGlzLm9wdGlvbnMuY2FudmFzO1xuICAgIGNvbnN0IGZhYnJpY2pzVGV4dE9iamVjdCA9IG5ldyBmYWJyaWMuVGV4dCh0ZXh0TWVzc2FnZSwgeyBsZWZ0OiBjYW52YXMud2lkdGggLSAxMDAsIHRvcDogMTAgfSk7XG4gICAgY2FudmFzLmFkZChmYWJyaWNqc1RleHRPYmplY3QpO1xuICAgIGNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRpbWEgb24gMDIvMDcvMjAxNy5cbiAqL1xuaW1wb3J0IFBpZWNlIGZyb20gJy4vUGllY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21wb3NpdGlvbiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IHBpZWNlcyA9IFtdO1xuXG4gICAgdGhpcy5hZGRQaWVjZSA9IChwaWVjZSkgPT4ge1xuICAgICAgaWYgKCEocGllY2UgaW5zdGFuY2VvZiBQaWVjZSkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ0NvbXBvc2l0aW9uIGNhbmB0IHN0b3JlIGFueXRoaW5nIGV4Y2VwdCBleGNlcHQgaW5zdGFuY2Ugb2YgUGllY2UnKTtcbiAgICAgIH1cbiAgICAgIHBpZWNlcy5wdXNoKHBpZWNlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRQaWVjZXMgPSAoKSA9PiBwaWVjZXM7XG4gIH1cbn1cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBkaW1hIG9uIDAyLzA3LzIwMTcuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVmaWVsZCB7XG4gIGNvbnN0cnVjdG9yKHsgd2lkdGggPSAxMDI0LCBoZWlnaHQgPSAxMDI0LCBjYW52YXNJZCA9ICdjJyB9ID0ge30pIHtcbiAgICBsZXQgY2FudmFzO1xuXG4gICAgdGhpcy5nZXRXaWR0aCA9ICgpID0+IHdpZHRoO1xuICAgIHRoaXMuZ2V0SGVpZ2h0ID0gKCkgPT4gaGVpZ2h0O1xuICAgIHRoaXMuZ2V0Q2FudmFzSWQgPSAoKSA9PiBjYW52YXNJZDtcbiAgICB0aGlzLnNldENhbnZhcyA9IChjYW52YXNGaWVsZCkgPT4ge1xuICAgICAgY2FudmFzID0gY2FudmFzRmllbGQ7XG4gICAgfTtcbiAgICB0aGlzLmdldENhbnZhcyA9ICgpID0+IGNhbnZhcztcblxuICAgIHRoaXMuY3JlYXRlRmllbGQoKTtcbiAgfVxuXG4gIGNyZWF0ZUZpZWxkKCkge1xuICAgIGNvbnN0IGNhbnZhc0lkID0gdGhpcy5nZXRDYW52YXNJZCgpO1xuICAgIGlmICghZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Y2FudmFzSWR9YCkpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjYW52YXMgZG9lc25gdCBleGlzdHMnKTtcbiAgICAgIC8vIGNyZWF0ZSBjYW52YXMgZWxlbWVudCBpZiBpdCBkb2Vzbid0IGV4aXN0cztcbiAgICAgIGNvbnN0IGNhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIGNhbnZhc0VsZW1lbnQuaWQgPSBjYW52YXNJZDtcbiAgICAgIGNhbnZhc0VsZW1lbnQud2lkdGggPSB0aGlzLmdldFdpZHRoKCk7XG4gICAgICBjYW52YXNFbGVtZW50LmhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCk7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhc0VsZW1lbnQpO1xuICAgIH1cbiAgICBjb25zdCBjYW52YXMgPSBuZXcgZmFicmljLkNhbnZhcyhjYW52YXNJZCwge1xuICAgICAgcmVuZGVyT25BZGRSZW1vdmU6IGZhbHNlLFxuICAgICAgc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJyMwZjAnLFxuICAgICAgd2lkdGg6IHRoaXMuZ2V0V2lkdGgoKSxcbiAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKSxcbiAgICB9KTtcbiAgICB0aGlzLnNldENhbnZhcyhjYW52YXMpO1xuICB9XG59XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGltYSBvbiAwMi8wNy8yMDE3LlxuICovXG5pbXBvcnQgSW1hZ2UgZnJvbSAnLi9JbWFnZSc7XG5pbXBvcnQgR2FtZWZpZWxkIGZyb20gJy4vR2FtZWZpZWxkJztcbmltcG9ydCBSZWNhbGN1bGF0ZWRPYmplY3RzR3JvdXAgZnJvbSAnLi9SZWNhbGN1bGF0ZWRPYmplY3RzR3JvdXAnO1xuaW1wb3J0IENhbnZhc0xvZ2dlciBmcm9tICcuL0NhbnZhc0xvZ2dlcic7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vTG9nZ2VyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZWxvb3Age1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLmltYWdlU2VsZWN0b3IpIHtcbiAgICAgIHRocm93IEVycm9yKCdpbWFnZSBzZWxlY3RvciBpcyBub3QgZGVmaW5lZCcpO1xuICAgIH1cbiAgICBsZXQgY2FudmFzO1xuICAgIHRoaXMuZ2V0T3B0aW9ucyA9ICgpID0+IG9wdGlvbnM7XG5cbiAgICB0aGlzLmdldENhbnZhcyA9ICgpID0+IGNhbnZhcztcbiAgICB0aGlzLnNldENhbnZhcyA9IChpbnRlcm5hbENhbnZhcykgPT4ge1xuICAgICAgY2FudmFzID0gaW50ZXJuYWxDYW52YXM7XG4gICAgfTtcbiAgfVxuXG4gIHN0YXJ0KCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucygpO1xuICAgICAgY29uc3QgZ2FtZUZpZWxkID0gbmV3IEdhbWVmaWVsZCh7XG4gICAgICAgIHdpZHRoOiAxNDIwLFxuICAgICAgICBoZWlnaHQ6IDIwNDgsXG4gICAgICAgIGNhbnZhc0lkOiBvcHRpb25zLmNhbnZhc0lkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjYW52YXMgPSBnYW1lRmllbGQuZ2V0Q2FudmFzKCk7XG4gICAgICB0aGlzLnNldENhbnZhcyhjYW52YXMpO1xuICAgICAgdGhpcy5kcmF3UGllY2VzKG9wdGlvbnMuc2NhbGUpO1xuICAgICAgY2FudmFzLm9uKCdvYmplY3Q6c2VsZWN0ZWQnLCAoKSA9PiB7XG4gICAgICAgIGlmICh3aW5kb3cuZGVidWdBcHApIHtcbiAgICAgICAgICBjb25zdCBjYW52YXNMb2dnZXIgPSBuZXcgQ2FudmFzTG9nZ2VyKHsgY2FudmFzIH0pO1xuICAgICAgICAgIGNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoeyBsb2dnZXJJbnRlcmZhY2U6IGNhbnZhc0xvZ2dlciB9KTtcbiAgICAgICAgICBjb25zdCBhY3RpdmVPYmplY3QgPSBjYW52YXMuZ2V0QWN0aXZlT2JqZWN0KCk7XG4gICAgICAgICAgbG9nZ2VyLmxvZyhhY3RpdmVPYmplY3QpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGNhbnZhcy5vbignb2JqZWN0Om1vZGlmaWVkJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVPYmplY3QgPSBjYW52YXMuZ2V0QWN0aXZlT2JqZWN0KCk7XG4gICAgICAgIGlmIChhY3RpdmVPYmplY3QgaW5zdGFuY2VvZiBmYWJyaWMuUGF0aCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhY3RpdmVPYmplY3QudHJpZ2dlcigncmVjYWxjdWxhdGUnKTtcbiAgICAgICAgY29uc3QgYWN0aXZlT2JqZWN0TmVpZ2hib3VycyA9IHRoaXMuZ2V0TmVpZ2hib3VycyhhY3RpdmVPYmplY3QpO1xuICAgICAgICBsZXQgaXNNZXJnZWQgPSBmYWxzZTtcbiAgICAgICAgY2FudmFzLmZvckVhY2hPYmplY3QoKHBvdGVudGlhbCkgPT4ge1xuICAgICAgICAgIGlmIChpc01lcmdlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocG90ZW50aWFsID09PSBhY3RpdmVPYmplY3QgfHwgIWFjdGl2ZU9iamVjdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChHYW1lbG9vcC5pc05laWdoYm91cihhY3RpdmVPYmplY3ROZWlnaGJvdXJzLCBwb3RlbnRpYWwpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0Nsb3Nlc3QoYWN0aXZlT2JqZWN0LCBwb3RlbnRpYWwpKSB7XG4gICAgICAgICAgICAgIGlzTWVyZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdGhpcy5kcmF3R3JvdXAoYWN0aXZlT2JqZWN0LCBwb3RlbnRpYWwpO1xuICAgICAgICAgICAgICBjYW52YXMucmVtb3ZlKGFjdGl2ZU9iamVjdCk7XG4gICAgICAgICAgICAgIGNhbnZhcy5yZW1vdmUocG90ZW50aWFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBkcmF3U3ZnKGltZykge1xuICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuZ2V0Q2FudmFzKCk7XG4gICAgY29uc3QgcGF0aCA9IG5ldyBmYWJyaWMuUGF0aChcbiAgICAgICdNODUuNDQ2LDUyLjI4NGMtMy45MDEsMC01LjIyMy0yLjE3LTUuNzczLTMuMDU4Yy0xLjE0Ni0xLjg1LTMuMjkxLTMuNDU1LTUuNDY5LTQuMjY4Yy0xLjA0OS0wLjI1MS0yLjE1OSwwLjM3Ny0yLjE2NSwyLjM0MiAgdjI0LjczN2gtMC4wMDF2MC4wMDFINDYuMjg3Yy0xLjk3OCwwLjAwMi0yLjYwNCwxLjEyMi0yLjM0NywyLjE3N2MwLjgxNSwyLjE3MywyLjQxOCw0LjMxMiw0LjI2NCw1LjQ1NyAgYzAuODg5LDAuNTUxLDMuMDU4LDEuODcyLDMuMDU4LDUuNzcyYzAsNS4yNzctNS45MzQsOS41NTUtMTMuMjUzLDkuNTU1Yy03LjMyLDAtMTMuMjU0LTQuMjc3LTEzLjI1NC05LjU1NSAgYzAtMy45MDEsMi4xNy01LjIyMiwzLjA1OS01Ljc3MmMxLjg0OC0xLjE0NywzLjQ1My0zLjI5MSw0LjI2OC01LjQ2OWMwLjI0OS0xLjA0OS0wLjM3OS0yLjE1OS0yLjM0Mi0yLjE2NUg1VjQ3LjMxNCAgYzAtMS45NzcsMS4xMTQtMi42MDYsMi4xNjYtMi4zNTVjMi4xNzgsMC44MTIsNC4zMjIsMi40MTgsNS40Nyw0LjI2OGMwLjU1MSwwLjg4OCwxLjg3MSwzLjA1OCw1Ljc3MiwzLjA1OCAgYzUuMjc4LDAsOS41NTYtNS45MzQsOS41NTYtMTMuMjU0YzAtNy4zMTktNC4yNzctMTMuMjUzLTkuNTU2LTEzLjI1M2MtMy45MDEsMC01LjIyMiwyLjE3LTUuNzcyLDMuMDU5ICBjLTEuMTQ2LDEuODQ1LTMuMjg0LDMuNDQ3LTUuNDU4LDQuMjYzQzYuMTIyLDMzLjM1Niw1LDMyLjcyNyw1LDMwLjc0NVY1aDY3LjAzOHYwLjAwMUw3Mi4wMzksNXYyNS43NTkgIGMwLjAwNiwxLjk3LDEuMTI0LDIuNTk3LDIuMTc3LDIuMzRjMi4xNzMtMC44MTUsNC4zMTItMi40MTgsNS40NTctNC4yNjNjMC41NTEtMC44ODksMS44NzItMy4wNTksNS43NzMtMy4wNTkgIGM1LjI3NiwwLDkuNTU0LDUuOTM0LDkuNTU0LDEzLjI1M0M5NSw0Ni4zNTEsOTAuNzIzLDUyLjI4NCw4NS40NDYsNTIuMjg0eicsXG4gICAgICB7XG4gICAgICAgIGZpbGw6IG5ldyBmYWJyaWMuUGF0dGVybih7XG4gICAgICAgICAgc291cmNlOiBpbWcsXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICApO1xuICAgIHBhdGguc2V0KHsgdG9wOiAxNTAsIGxlZnQ6IDE1MCB9KTtcbiAgICBjYW52YXMuYWRkKHBhdGgpO1xuICAgIGNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfVxuXG4gIGRyYXdQaWVjZXMoc2NhbGUgPSAxKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucygpO1xuICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuZ2V0Q2FudmFzKCk7XG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2Uob3B0aW9ucy5pbWFnZVNlbGVjdG9yKTtcblxuICAgIGltYWdlLnNwbGl0SW1hZ2VUb1BpZWNlcyh7IGNvbExlbmd0aDogb3B0aW9ucy5jb2xzLCByb3dMZW5ndGg6IG9wdGlvbnMucm93cyB9KTtcbiAgICBjb25zdCBwaWVjZXMgPSBpbWFnZS5nZXRJbWFnZVBpZWNlcygpO1xuXG4gICAgcGllY2VzLmZvckVhY2goKHBpZWNlLCBwaWVjZVBvc2l0aW9uKSA9PiB7XG4gICAgICBjb25zdCBsYXN0ID0gcGllY2VQb3NpdGlvbiA9PT0gKHBpZWNlcy5sZW5ndGggLSAxKTtcbiAgICAgIGNvbnN0IGRyYXdDYWxsYmFjayA9IEdhbWVsb29wLmRyYXdDYWxsYmFjay5iaW5kKG51bGwsIHsgY2FudmFzLCBsYXN0LCBwaWVjZVBvc2l0aW9uLCBzY2FsZSB9KTtcbiAgICAgIC8vIGNvbnN0IGRyYXdTdmcgPSB0aGlzLmRyYXdTdmcuYmluZCh0aGlzKTtcbiAgICAgIGZhYnJpYy5JbWFnZS5mcm9tVVJMKHBpZWNlLmdldENvbnRlbnQoKSwgZHJhd0NhbGxiYWNrKTtcbiAgICAgIC8vIGZhYnJpYy51dGlsLmxvYWRJbWFnZShwaWVjZS5nZXRDb250ZW50KCksIGRyYXdTdmcpO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGRyYXdDYWxsYmFjayhhZGRpdGlvbmFsUGFyYW1zLCBpbWcpIHtcbiAgICBjb25zdCB7IGNhbnZhcywgbGFzdCwgcGllY2VQb3NpdGlvbiwgc2NhbGUgfSA9IGFkZGl0aW9uYWxQYXJhbXM7XG4gICAgY29uc3QgdG9wID0gZmFicmljLnV0aWwuZ2V0UmFuZG9tSW50KDAsIDMwMCk7XG4gICAgY29uc3QgbGVmdCA9IGZhYnJpYy51dGlsLmdldFJhbmRvbUludCgwLCAzMDApO1xuXG4gICAgaW1nLnNldCgnaGFzQ29udHJvbHMnLCBmYWxzZSk7XG4gICAgaW1nLnNldCgnaGFzQm9yZGVycycsIGZhbHNlKTtcbiAgICBpbWcuc2V0KCd0b3AnLCB0b3ApO1xuICAgIGltZy5zZXQoJ2xlZnQnLCBsZWZ0KTtcbiAgICBpbWcuc2V0KCdwaWVjZVBvc2l0aW9uJywgcGllY2VQb3NpdGlvbik7XG4gICAgaW1nLnNjYWxlKHNjYWxlKTtcblxuICAgIGNhbnZhcy5hZGQoaW1nKTtcbiAgICBpZiAobGFzdCkge1xuICAgICAgY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldE5laWdoYm91cnMoZXhhbU9iamVjdCkge1xuICAgIGNvbnN0IG5laWdoYm91cnMgPSBbXTtcbiAgICBpZiAoZXhhbU9iamVjdCkge1xuICAgICAgbGV0IHBpZWNlUG9zaXRpb25zID0gW107XG4gICAgICBpZiAodHlwZW9mIGV4YW1PYmplY3QucGllY2VQb3NpdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcGllY2VQb3NpdGlvbnMucHVzaChleGFtT2JqZWN0LnBpZWNlUG9zaXRpb24pO1xuICAgICAgfSBlbHNlIGlmIChleGFtT2JqZWN0LnBpZWNlUG9zaXRpb25zIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgcGllY2VQb3NpdGlvbnMgPSBleGFtT2JqZWN0LnBpZWNlUG9zaXRpb25zO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ2V4YW1PYmplY3QgZG9lc25gdCBjb250YWluIGFueSBpbmZvIGFib3V0IHBpZWNlIHBvc2l0aW9uJyk7XG4gICAgICB9XG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5nZXRPcHRpb25zKCk7XG4gICAgICBwaWVjZVBvc2l0aW9ucy5mb3JFYWNoKChwaWVjZVBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdHVhbFJvdyA9IE1hdGguZmxvb3IocGllY2VQb3NpdGlvbiAvIG9wdGlvbnMuY29scyk7XG4gICAgICAgIGNvbnN0IGFjdHVhbENvbCA9IHBpZWNlUG9zaXRpb24gJSBvcHRpb25zLmNvbHM7XG4gICAgICAgIGlmIChhY3R1YWxSb3cgIT09IDApIHtcbiAgICAgICAgICBuZWlnaGJvdXJzLnB1c2goKHBpZWNlUG9zaXRpb24gLSBvcHRpb25zLmNvbHMpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0dWFsUm93IDwgKG9wdGlvbnMucm93cyAtIDEpKSB7XG4gICAgICAgICAgbmVpZ2hib3Vycy5wdXNoKChwaWVjZVBvc2l0aW9uICsgb3B0aW9ucy5jb2xzKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0dWFsQ29sICE9PSAwKSB7XG4gICAgICAgICAgbmVpZ2hib3Vycy5wdXNoKChwaWVjZVBvc2l0aW9uIC0gMSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY3R1YWxDb2wgPCAob3B0aW9ucy5jb2xzIC0gMSkpIHtcbiAgICAgICAgICBuZWlnaGJvdXJzLnB1c2goKHBpZWNlUG9zaXRpb24gKyAxKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbmVpZ2hib3VycztcbiAgfVxuXG4gIGlzQ2xvc2VzdChjdXJyZW50LCBwb3RlbnRpYWwpIHtcbiAgICBjb25zdCBhY3RpdmVPYmplY3RJdGVtcyA9IGN1cnJlbnQgaW5zdGFuY2VvZiBmYWJyaWMuR3JvdXAgPyBjdXJyZW50LmdldE9iamVjdHMoKSA6IFtjdXJyZW50XTtcbiAgICBjb25zdCBwb3RlbnRpYWxJdGVtcyA9IHBvdGVudGlhbCBpbnN0YW5jZW9mIGZhYnJpYy5Hcm91cCA/IHBvdGVudGlhbC5nZXRPYmplY3RzKCkgOiBbcG90ZW50aWFsXTtcblxuICAgIGZvciAoY29uc3QgYWN0aXZlSXRlbSBvZiBhY3RpdmVPYmplY3RJdGVtcykge1xuICAgICAgZm9yIChjb25zdCBwb3RlbnRpYWxJdGVtIG9mIHBvdGVudGlhbEl0ZW1zKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUGllY2VzQ2xvc2UoYWN0aXZlSXRlbSwgcG90ZW50aWFsSXRlbSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc1BpZWNlc0Nsb3NlKGZpcnN0UGllY2UsIHNlY29uZFBpZWNlKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucygpO1xuICAgIGNvbnN0IGNsb3Nlc3RTZW5zaXRpdml0eSA9IG9wdGlvbnMubmVpZ2hib3Vyc1NlbnNpdGl2aXR5O1xuICAgIGxldCB4RGlmZmVyZW5jZSA9IE1hdGguYWJzKGZpcnN0UGllY2UuYUNvb3Jkcy50ci54IC0gc2Vjb25kUGllY2UuYUNvb3Jkcy50bC54KTtcbiAgICBsZXQgeURpZmZlcmVuY2UgPSBNYXRoLmFicyhmaXJzdFBpZWNlLmFDb29yZHMudHIueSAtIHNlY29uZFBpZWNlLmFDb29yZHMudGwueSk7XG4gICAgaWYgKHhEaWZmZXJlbmNlIDwgY2xvc2VzdFNlbnNpdGl2aXR5ICYmIHlEaWZmZXJlbmNlIDwgY2xvc2VzdFNlbnNpdGl2aXR5KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICB4RGlmZmVyZW5jZSA9IE1hdGguYWJzKGZpcnN0UGllY2UuYUNvb3Jkcy50bC54IC0gc2Vjb25kUGllY2UuYUNvb3Jkcy50ci54KTtcbiAgICB5RGlmZmVyZW5jZSA9IE1hdGguYWJzKGZpcnN0UGllY2UuYUNvb3Jkcy50bC55IC0gc2Vjb25kUGllY2UuYUNvb3Jkcy50ci55KTtcbiAgICBpZiAoeERpZmZlcmVuY2UgPCBjbG9zZXN0U2Vuc2l0aXZpdHkgJiYgeURpZmZlcmVuY2UgPCBjbG9zZXN0U2Vuc2l0aXZpdHkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHhEaWZmZXJlbmNlID0gTWF0aC5hYnMoZmlyc3RQaWVjZS5hQ29vcmRzLmJsLnggLSBzZWNvbmRQaWVjZS5hQ29vcmRzLnRsLngpO1xuICAgIHlEaWZmZXJlbmNlID0gTWF0aC5hYnMoZmlyc3RQaWVjZS5hQ29vcmRzLmJsLnkgLSBzZWNvbmRQaWVjZS5hQ29vcmRzLnRsLnkpO1xuICAgIGlmICh4RGlmZmVyZW5jZSA8IGNsb3Nlc3RTZW5zaXRpdml0eSAmJiB5RGlmZmVyZW5jZSA8IGNsb3Nlc3RTZW5zaXRpdml0eSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgeERpZmZlcmVuY2UgPSBNYXRoLmFicyhmaXJzdFBpZWNlLmFDb29yZHMudGwueCAtIHNlY29uZFBpZWNlLmFDb29yZHMuYmwueCk7XG4gICAgeURpZmZlcmVuY2UgPSBNYXRoLmFicyhmaXJzdFBpZWNlLmFDb29yZHMudGwueSAtIHNlY29uZFBpZWNlLmFDb29yZHMuYmwueSk7XG4gICAgcmV0dXJuIHhEaWZmZXJlbmNlIDwgY2xvc2VzdFNlbnNpdGl2aXR5ICYmIHlEaWZmZXJlbmNlIDwgY2xvc2VzdFNlbnNpdGl2aXR5O1xuICB9XG5cbiAgc3RhdGljIGlzTmVpZ2hib3VyKGFjdGl2ZU9iamVjdE5laWdoYm91cnMsIHBvdGVudGlhbCkge1xuICAgIGlmIChwb3RlbnRpYWwgaW5zdGFuY2VvZiBmYWJyaWMuR3JvdXApIHtcbiAgICAgIGZvciAoY29uc3QgcG90ZW50aWFsSXRlbSBvZiBwb3RlbnRpYWwuZ2V0T2JqZWN0cygpKSB7XG4gICAgICAgIGlmIChhY3RpdmVPYmplY3ROZWlnaGJvdXJzLmluZGV4T2YocG90ZW50aWFsSXRlbS5waWVjZVBvc2l0aW9uKSAhPT0gLTEpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHBvdGVudGlhbC5waWVjZVBvc2l0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIGFjdGl2ZU9iamVjdE5laWdoYm91cnMuaW5kZXhPZihwb3RlbnRpYWwucGllY2VQb3NpdGlvbikgIT09IC0xO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBkcmF3R3JvdXAoYWN0aXZlT2JqZWN0LCBwb3RlbnRpYWwpIHtcbiAgICBjb25zdCBjYW52YXMgPSB0aGlzLmdldENhbnZhcygpO1xuICAgIGNvbnN0IGdyb3VwSXRlbXMgPSBbXTtcbiAgICBjb25zdCBwaWVjZVBvc2l0aW9ucyA9IFtdO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnMoKTtcbiAgICBjb25zdCBiYXNlRWxlbWVudHMgPSBwb3RlbnRpYWwgaW5zdGFuY2VvZiBmYWJyaWMuR3JvdXAgPyBwb3RlbnRpYWwuZ2V0T2JqZWN0cygpIDogW3BvdGVudGlhbF07XG4gICAgY29uc3QgYWN0aXZlT2JqZWN0cyA9IGFjdGl2ZU9iamVjdCBpbnN0YW5jZW9mIGZhYnJpYy5Hcm91cCA/IGFjdGl2ZU9iamVjdC5nZXRPYmplY3RzKCkgOiBbYWN0aXZlT2JqZWN0XTtcblxuICAgIC8vIGJhc2VFbGVtZW50IGlzIHRoZSBwb3RlbnRpYWwgZWxlbWVudCBpdHNlbGYgb3IgZmlyc3QgZWxlbWVudCBmcm9tIGdyb3VwO1xuICAgIGNvbnN0IGJhc2VFbGVtZW50ID0gYmFzZUVsZW1lbnRzWzBdO1xuICAgIGNvbnN0IHsgY29sLCByb3cgfSA9IEdhbWVsb29wLmV4dHJhY3RDb29yZGluYXRlcyhiYXNlRWxlbWVudCwgb3B0aW9ucy5jb2xzKTtcbiAgICBjb25zdCB6ZXJvRGlzcGxhY2VtZW50WCA9IGNvbCAqIGJhc2VFbGVtZW50LmdldFdpZHRoKCk7XG4gICAgY29uc3QgemVyb0Rpc3BsYWNlbWVudFkgPSByb3cgKiBiYXNlRWxlbWVudC5nZXRIZWlnaHQoKTtcbiAgICBjb25zdCB4RGlzcGxhY2VtZW50ID0gYmFzZUVsZW1lbnQubGVmdCAtIHplcm9EaXNwbGFjZW1lbnRYO1xuICAgIGNvbnN0IHlEaXNwbGFjZW1lbnQgPSBiYXNlRWxlbWVudC50b3AgLSB6ZXJvRGlzcGxhY2VtZW50WTtcblxuICAgIGNvbnN0IGl0ZW1EZWNvbXBvc2UgPSAoYWN0aXZlUGllY2UpID0+IHtcbiAgICAgIHRoaXMucmVjYWxjdWxhdGVQaWVjZVBvc2l0aW9ucyh7XG4gICAgICAgIG9iajogYWN0aXZlUGllY2UsXG4gICAgICAgIHhEaXNwbGFjZW1lbnQsXG4gICAgICAgIHlEaXNwbGFjZW1lbnQsXG4gICAgICB9KTtcbiAgICAgIHBpZWNlUG9zaXRpb25zLnB1c2goYWN0aXZlUGllY2UucGllY2VQb3NpdGlvbik7XG4gICAgICBncm91cEl0ZW1zLnB1c2goYWN0aXZlUGllY2UpO1xuICAgIH07XG5cbiAgICBhY3RpdmVPYmplY3RzLmZvckVhY2goaXRlbURlY29tcG9zZSk7XG4gICAgYmFzZUVsZW1lbnRzLmZvckVhY2goaXRlbURlY29tcG9zZSk7XG5cbiAgICBjb25zdCBpdGVtc1JlY2FsY3VsYWJsZUdyb3VwID0gbmV3IFJlY2FsY3VsYXRlZE9iamVjdHNHcm91cChncm91cEl0ZW1zLCB7XG4gICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICBoYXNCb3JkZXJzOiBmYWxzZSxcbiAgICB9KTtcbiAgICBpdGVtc1JlY2FsY3VsYWJsZUdyb3VwLnNldCgncGllY2VQb3NpdGlvbnMnLCBwaWVjZVBvc2l0aW9ucyk7XG4gICAgY2FudmFzLmFkZChpdGVtc1JlY2FsY3VsYWJsZUdyb3VwKTtcbiAgICBjYW52YXMucmVuZGVyQWxsKCk7XG5cbiAgICAvLyByZWNhbGN1bGF0ZWQgZ3JvdXAgb2JqZWN0cyBjb29yZGluYXRlc1xuICAgIC8vIGl0IHByZXZlbnRzIHRvIGRpc2FwcGVhcmluZyBncm91cCBvYmplY3QgYWZ0ZXIgbWVyZ2VcbiAgICBpdGVtc1JlY2FsY3VsYWJsZUdyb3VwLnRyaWdnZXIoJ3NlbGVjdGVkJyk7XG4gICAgaXRlbXNSZWNhbGN1bGFibGVHcm91cC50cmlnZ2VyKCdyZWNhbGN1bGF0ZScpO1xuICB9XG5cbiAgcmVjYWxjdWxhdGVQaWVjZVBvc2l0aW9ucyh7IG9iaiwgeERpc3BsYWNlbWVudCwgeURpc3BsYWNlbWVudCB9KSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucygpO1xuICAgIGNvbnN0IHsgY29sLCByb3cgfSA9IEdhbWVsb29wLmV4dHJhY3RDb29yZGluYXRlcyhvYmosIG9wdGlvbnMuY29scyk7XG4gICAgY29uc3QgemVyb0Rpc3BsYWNlbWVudFRvcCA9IHJvdyAqIG9iai5nZXRIZWlnaHQoKTtcbiAgICBjb25zdCB6ZXJvRGlzcGxhY2VtZW50TGVmdCA9IGNvbCAqIG9iai5nZXRXaWR0aCgpO1xuICAgIGNvbnN0IHJlY2FsY3VsYXRlZFRvcCA9IHplcm9EaXNwbGFjZW1lbnRUb3AgKyB5RGlzcGxhY2VtZW50O1xuICAgIGNvbnN0IHJlY2FsY3VsYXRlZExlZnQgPSB6ZXJvRGlzcGxhY2VtZW50TGVmdCArIHhEaXNwbGFjZW1lbnQ7XG4gICAgb2JqLnNldFRvcChyZWNhbGN1bGF0ZWRUb3ApO1xuICAgIG9iai5zZXRMZWZ0KHJlY2FsY3VsYXRlZExlZnQpO1xuICAgIG9iai5zZXRDb29yZHMoKTtcbiAgfVxuXG4gIHN0YXRpYyBleHRyYWN0Q29vcmRpbmF0ZXMob2JqLCBjb2xzKSB7XG4gICAgY29uc3QgY29sID0gb2JqLnBpZWNlUG9zaXRpb24gJSBjb2xzO1xuICAgIGNvbnN0IHJvdyA9IE1hdGguZmxvb3Iob2JqLnBpZWNlUG9zaXRpb24gLyBjb2xzKTtcbiAgICByZXR1cm4geyBjb2wsIHJvdyB9O1xuICB9XG59XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGltYSBvbiAwOS8wNi8yMDE3LlxuICovXG5pbXBvcnQgUGllY2UgZnJvbSAnLi9QaWVjZSc7XG5pbXBvcnQgQ29tcG9zaXRpb24gZnJvbSAnLi9Db21wb3NpdGlvbic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEltYWdlIHtcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3IpIHtcbiAgICBjb25zdCBpbWFnZVNlbGVjdG9yID0gYGltZyR7c2VsZWN0b3J9YDtcbiAgICB0aGlzLmltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaW1hZ2VTZWxlY3Rvcik7XG4gICAgaWYgKCF0aGlzLmltYWdlRWxlbWVudCkge1xuICAgICAgdGhyb3cgRXJyb3IoYFRoZXJlIGlzIG5vIGltZyBlbGVtZW50IHdpdGggcHJvdmlkZWQgc2VsZWN0b3IgJHtpbWFnZVNlbGVjdG9yfWApO1xuICAgIH1cblxuICAgIHRoaXMuaW1hZ2VJbnN0YW5jZSA9IHRoaXMuZ2V0RmFicmljSW1hZ2VJbnN0YW5jZSgpO1xuICAgIHRoaXMuaW1hZ2VQaWVjZXMgPSBuZXcgQ29tcG9zaXRpb24oKTtcbiAgfVxuXG4gIGdldEZhYnJpY0ltYWdlSW5zdGFuY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VJbnN0YW5jZSB8fCBuZXcgZmFicmljLkltYWdlKHRoaXMuaW1hZ2VFbGVtZW50KTtcbiAgfVxuXG4gIHNwbGl0SW1hZ2VUb1BpZWNlcyh7IGNvbExlbmd0aCA9IDYsIHJvd0xlbmd0aCA9IDYgfSA9IHt9KSB7XG4gICAgY29uc3QgY29sU2l6ZSA9IHRoaXMuaW1hZ2VJbnN0YW5jZS5nZXRXaWR0aCgpIC8gY29sTGVuZ3RoO1xuICAgIGNvbnN0IHJvd1NpemUgPSB0aGlzLmltYWdlSW5zdGFuY2UuZ2V0SGVpZ2h0KCkgLyByb3dMZW5ndGg7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgcm93TGVuZ3RoOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgY29sTGVuZ3RoOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBkYXRhVXJsID0gdGhpcy5pbWFnZUluc3RhbmNlLnRvRGF0YVVSTCh7XG4gICAgICAgICAgbGVmdDogY29sU2l6ZSAqIGNvbCxcbiAgICAgICAgICB0b3A6IHJvd1NpemUgKiByb3csXG4gICAgICAgICAgd2lkdGg6IGNvbFNpemUsXG4gICAgICAgICAgaGVpZ2h0OiByb3dTaXplLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcGllY2VPcHRpb25zID0ge1xuICAgICAgICAgIGNvbnRlbnQ6IGRhdGFVcmwsXG4gICAgICAgICAgcG9zaXRpb246IHJvdyAqIGNvbCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcGllY2UgPSBuZXcgUGllY2UocGllY2VPcHRpb25zKTtcbiAgICAgICAgdGhpcy5pbWFnZVBpZWNlcy5hZGRQaWVjZShwaWVjZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0SW1hZ2VQaWVjZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VQaWVjZXMuZ2V0UGllY2VzKCk7XG4gIH1cblxuICBnZXRJbWFnZUVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VFbGVtZW50O1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dnZXIge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICBsb2dnZXJJbnRlcmZhY2U6IGNvbnNvbGUsXG4gICAgfTtcbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAuLi5kZWZhdWx0T3B0aW9ucyxcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfTtcbiAgfVxuXG4gIGxvZyhtZXNzYWdlKSB7XG4gICAgdGhpcy5vcHRpb25zLmxvZ2dlckludGVyZmFjZS5sb2cobWVzc2FnZSk7XG4gIH1cbn1cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBkaW1hIG9uIDAyLzA3LzIwMTcuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBpZWNlIHtcbiAgY29uc3RydWN0b3IoeyBjb250ZW50LCBwb3NpdGlvbiB9ID0ge30pIHtcbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBwb3NpdGlvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRocm93IEVycm9yKCdwaWVjZSByZXF1aXJlZCBjb250ZW50IGFuZCBwb3NpdGlvbicpO1xuICAgIH1cbiAgICB0aGlzLmdldENvbnRlbnQgPSAoKSA9PiBjb250ZW50O1xuICAgIHRoaXMuZ2V0UG9zaXRpb24gPSAoKSA9PiBwb3NpdGlvbjtcbiAgICByZXR1cm4gdGhpcy5nZXRDb250ZW50KCk7XG4gIH1cblxuICBnZXRSb3coY29scykge1xuICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMuZ2V0UG9zaXRpb24oKSAvIGNvbHMpO1xuICB9XG5cbiAgZ2V0Q29sKGNvbHMpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRQb3NpdGlvbigpICUgY29scztcbiAgfVxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRpbWEgb24gMDcvMDcvMjAxNy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVjYWxjdWxhdGVkT2JqZWN0c0dyb3VwIHtcbiAgY29uc3RydWN0b3IoZ3JvdXBJdGVtcywgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGdyb3VwSXRlbXMpKSB7XG4gICAgICB0aHJvdyBFcnJvcignR3JvdXAgSXRlbXMgbXVzdCBiZSBhbiBhcnJheScpO1xuICAgIH1cbiAgICBjb25zdCBncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAoZ3JvdXBJdGVtcywgb3B0aW9ucyk7XG4gICAgZ3JvdXAub24oJ3NlbGVjdGVkJywgdGhpcy5vblNlbGVjdGVkKTtcbiAgICBncm91cC5vbigncmVjYWxjdWxhdGUnLCB0aGlzLm9uTW9kaWZpZWQpO1xuXG4gICAgZ3JvdXAucmVjYWxjdWxhdGVBQ29vcmRzID0gdGhpcy5yZWNhbGN1bGF0ZUFDb29yZHM7XG4gICAgZ3JvdXAub25Nb2RpZmllZCA9IHRoaXMub25Nb2RpZmllZDtcbiAgICByZXR1cm4gZ3JvdXA7XG4gIH1cblxuICBvblNlbGVjdGVkKCkge1xuICAgIHRoaXMuc2VsZWN0ZWRUb3AgPSB0aGlzLnRvcDtcbiAgICB0aGlzLnNlbGVjdGVkTGVmdCA9IHRoaXMubGVmdDtcbiAgfVxuXG4gIG9uTW9kaWZpZWQoKSB7XG4gICAgY29uc3QgZ3JvdXBPYmplY3RzID0gdGhpcy5nZXRPYmplY3RzKCk7XG4gICAgZ3JvdXBPYmplY3RzLmZvckVhY2goKGdyb3VwSXRlbSkgPT4ge1xuICAgICAgdGhpcy5yZWNhbGN1bGF0ZUFDb29yZHMoZ3JvdXBJdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlY2FsY3VsYXRlQUNvb3JkcyhpdGVtKSB7XG4gICAgY29uc3QgY29vcmRzID0ge307XG4gICAgY29uc3QgaXRlbUNvb3JkcyA9IGl0ZW0uYUNvb3JkcztcbiAgICBjb25zdCB4ID0gdGhpcy5sZWZ0IC0gdGhpcy5zZWxlY3RlZExlZnQ7XG4gICAgY29uc3QgeSA9IHRoaXMudG9wIC0gdGhpcy5zZWxlY3RlZFRvcDtcbiAgICBjb25zdCBvZmZzZXQgPSB7IHgsIHkgfTtcblxuICAgIGNvb3Jkcy50ciA9IG5ldyBmYWJyaWMuUG9pbnQoaXRlbUNvb3Jkcy50ci54ICsgb2Zmc2V0LngsIGl0ZW1Db29yZHMudHIueSArIG9mZnNldC55KTtcbiAgICBjb29yZHMudGwgPSBuZXcgZmFicmljLlBvaW50KGl0ZW1Db29yZHMudGwueCArIG9mZnNldC54LCBpdGVtQ29vcmRzLnRsLnkgKyBvZmZzZXQueSk7XG4gICAgY29vcmRzLmJyID0gbmV3IGZhYnJpYy5Qb2ludChpdGVtQ29vcmRzLmJyLnggKyBvZmZzZXQueCwgaXRlbUNvb3Jkcy5ici55ICsgb2Zmc2V0LnkpO1xuICAgIGNvb3Jkcy5ibCA9IG5ldyBmYWJyaWMuUG9pbnQoaXRlbUNvb3Jkcy5ibC54ICsgb2Zmc2V0LngsIGl0ZW1Db29yZHMuYmwueSArIG9mZnNldC55KTtcbiAgICBpdGVtLmFDb29yZHMgPSBjb29yZHM7XG4gICAgaXRlbS50b3AgPSBjb29yZHMudGwueTtcbiAgICBpdGVtLmxlZnQgPSBjb29yZHMudGwueDtcbiAgfVxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRpbWEgb24gMTgvMDUvMjAxNy5cbiAqL1xuaW1wb3J0IEdhbWVsb29wIGZyb20gJy4vY2xhc3Nlcy9HYW1lbG9vcCc7XG5cbmNvbnN0IG9wdGlvbnMgPSB7XG4gIGNhbnZhc0lkOiAnYycsXG4gIHJvd3M6IDYsXG4gIGNvbHM6IDYsXG4gIHNjYWxlOiAwLjgsXG4gIGltYWdlU2VsZWN0b3I6ICdbampwLWltYWdlXScsXG4gIG5laWdoYm91cnNTZW5zaXRpdml0eTogMjAsXG59O1xuY29uc3QgZ2FtZUxvb3AgPSBuZXcgR2FtZWxvb3Aob3B0aW9ucyk7XG5cbmdhbWVMb29wLnN0YXJ0KCk7XG4iXX0="}